@echo off
echo ================================================================================
echo          Bienvenue dans le programme d'installation de Malware Detector
echo ================================================================================


python --version >nul 2>&1
if %ERRORLEVEL% neq 0 (
    echo Python n'est pas installe. Veuillez installer Python d'abord.
    exit /b
)

if not exist Malware-Detector (
    echo Clonage de Malware Detector...
    git clone https://github.com/AbdrrahimDahmani/Malware-Detector.git
)

:: Naviguer dans le dossier du projet
cd Malware-Detector


:: Installer les dependances Python requises
echo Installation des dependances requises...
pip install -r requirements.txt

:: Initialiser la base de donnees SQLite
echo Initialisation de la base de donnees SQLite...
python -c "import sqlite3; sqlite3.connect('file_hashes.db').close()"

:menu
echo.
echo Selectionnez une option :
echo 1. Verifier l'integrite des fichiers
echo 2. Scanner un hash de fichier avec VirusTotal
echo 3. Scanner plusieurs hashes depuis un fichier et enregistrer les resultats
echo 4. Televerser un fichier et verifier les anomalies
echo 5. Activer la surveillance en temps reel des nouveaux fichiers telecharges
echo 6. Afficher l'historique des scans
echo 7. Quitter
set /p choice=Entrez votre choix (1-7) :

if "%choice%"=="1" (
    echo.
    set /p directory=Entrez le chemin du dossier pour verifier l'integrite : 
    python script.py --check-integrity %directory%
    goto menu
) 

if "%choice%"=="2" (
    echo.
    set /p hash=Entrez le hash du fichier à scanner : 
    python script.py --scan-hash %hash%
    goto menu
)

if "%choice%"=="3" (
    echo.
    set /p directory_path=Entrez le chemin du fichier contenant les hashes Sha256 : 
    python script.py --check-hashes %directory_path%
    goto menu
)

if "%choice%"=="4" (
    echo.
    set /p file_path=Entrez le chemin du fichier pour verifier les anomalies : 
    python script.py --scan-file %file_path%
    goto menu
)

if "%choice%"=="5" (
    echo Malware Detector sera execute en arrière-plan pour assurer la surveillance en temps reel des nouveaux fichiers telecharges : 
    start /B python script.py --lancer-surveillance
    goto menu
)

if "%choice%"=="6" (
    python script.py --all
    goto menu
)
if "%choice%"=="7" (
    echo Quitter...
    exit /b
)

echo Choix invalide, veuillez reessayer.
goto menu
